<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AYLA Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="admin-body">

<div class="admin-container">
    <div id="login-screen" class="admin-card login-card">
        <h1>AYLA Admin</h1>
        <p style="color: var(--text-muted); margin-bottom: 20px;">–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
        <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å (12345)" class="admin-input big-input" onkeyup="if(event.key === 'Enter') checkPassword()">
        <button onclick="checkPassword()" class="admin-btn primary-btn full-width">–í–æ–π—Ç–∏</button>
        <p id="login-error" style="color: var(--danger); margin-top: 10px; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</p>
    </div>

    <div id="admin-panel" class="hidden animate-fade-in">
        <header class="admin-header">
            <h2>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <button onclick="logout()" class="admin-btn text-btn">–í—ã–π—Ç–∏</button>
        </header>

        <section class="admin-section">
            <div class="section-header">
                <h3>üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            </div>

            <div class="admin-card form-card">
                <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h4>
                <div class="form-row">
                    <input type="text" id="cat-name-ru" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (RU)" class="admin-input">
                    <input type="text" id="cat-name-en" placeholder="Name (EN)" class="admin-input">
                </div>
                <input type="text" id="cat-image" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É" class="admin-input">
                <button onclick="addCategory()" class="admin-btn primary-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>

            <div id="admin-categories-list" class="admin-list">
            </div>
        </section>

        <section id="items-section" class="admin-section hidden">
            <div class="section-header">
                <h3>‚òïÔ∏è –¢–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: <span id="current-cat-name" style="color: var(--accent);">...</span></h3>
            </div>

            <div class="admin-card form-card">
                <h4>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h4>
                <div class="form-row">
                    <input type="text" id="item-name-ru" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (RU)" class="admin-input">
                    <input type="text" id="item-name-en" placeholder="Name (EN)" class="admin-input">
                </div>
                <div class="form-row">
                    <input type="text" id="item-desc-ru" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (RU)" class="admin-input">
                    <input type="text" id="item-desc-en" placeholder="Description (EN)" class="admin-input">
                </div>
                <div class="form-row">
                    <input type="number" id="item-price" placeholder="–¶–µ–Ω–∞ (250)" class="admin-input">
                    <input type="text" id="item-image" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É" class="admin-input">
                </div>
                <button onclick="addItem()" class="admin-btn primary-btn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>

            <div id="admin-items-list" class="admin-list">
            </div>
        </section>
    </div>
</div>

<script>
    let currentCatId = null;

    // === –õ–û–ì–ò–ö–ê –í–•–û–î–ê ===
    function checkPassword() {
        const pass = document.getElementById('admin-pass').value;
        const errorMsg = document.getElementById('login-error');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å—Ç–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É = –Ω–µ—Ç –æ—à–∏–±–∫–∏ —Å–µ—Ç–∏)
        if(pass === '12345') {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            loadCategories(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
        } else {
            errorMsg.style.display = 'block';
            errorMsg.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!";
        }
    }

    function logout() {
        location.reload();
    }

    // === –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò ===

    async function loadCategories() {
        try {
            const res = await fetch('/api/categories');
            const categories = await res.json();
            const list = document.getElementById('admin-categories-list');
            list.innerHTML = '';

            categories.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'admin-list-item';
                div.innerHTML = `
                    <img src="${cat.image || 'img/placeholder.png'}" onerror="this.src='https://via.placeholder.com/60'">
                    <div class="item-details">
                        <span class="ru">${cat.name_ru}</span>
                        <span class="en">${cat.name_en}</span>
                    </div>
                    <button onclick="selectCategory(${cat.id}, '${cat.name_ru}')" class="admin-btn sm-btn" style="margin-right:5px">–û—Ç–∫—Ä—ã—Ç—å</button>
                    <button onclick="deleteCategory(${cat.id})" class="admin-btn danger-btn sm-btn">X</button>
                `;
                list.appendChild(div);
            });
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ server.js –∑–∞–ø—É—â–µ–Ω.");
        }
    }

    async function addCategory() {
        const name_ru = document.getElementById('cat-name-ru').value;
        const name_en = document.getElementById('cat-name-en').value;
        const image = document.getElementById('cat-image').value;

        if(!name_ru) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!');

        await fetch('/api/admin/categories', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name_ru, name_en, image})
        });

        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
        document.getElementById('cat-name-ru').value = '';
        document.getElementById('cat-name-en').value = '';
        document.getElementById('cat-image').value = '';

        loadCategories();
    }

    async function deleteCategory(id) {
        if(confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–µ–π?')) {
            await fetch(`/api/admin/categories/${id}`, {method: 'DELETE'});
            loadCategories();
            document.getElementById('items-section').classList.add('hidden');
        }
    }

    function selectCategory(id, name) {
        currentCatId = id;
        document.getElementById('current-cat-name').textContent = name;
        document.getElementById('items-section').classList.remove('hidden');
        loadItems(id);

        // –°–∫—Ä–æ–ª–ª –≤–Ω–∏–∑ –∫ —Ç–æ–≤–∞—Ä–∞–º
        document.getElementById('items-section').scrollIntoView({behavior: 'smooth'});
    }

    async function loadItems(catId) {
        const res = await fetch(`/api/items?category_id=${catId}`);
        const items = await res.json();
        const list = document.getElementById('admin-items-list');
        list.innerHTML = '';

        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'admin-list-item';
            div.innerHTML = `
                <img src="${item.image || 'img/placeholder.png'}" onerror="this.src='https://via.placeholder.com/60'">
                <div class="item-details">
                    <span class="ru">${item.name_ru}</span>
                    <span class="price">${item.price} ‚ÇΩ</span>
                </div>
                <button onclick="deleteItem(${item.id})" class="admin-btn danger-btn sm-btn">X</button>
            `;
            list.appendChild(div);
        });
    }

    async function addItem() {
        if(!currentCatId) return;

        const name_ru = document.getElementById('item-name-ru').value;
        const name_en = document.getElementById('item-name-en').value;
        const description_ru = document.getElementById('item-desc-ru').value;
        const description_en = document.getElementById('item-desc-en').value;
        const price = document.getElementById('item-price').value;
        const image = document.getElementById('item-image').value;

        if(!name_ru || !price) return alert('–ù—É–∂–Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω–∞!');

        await fetch('/api/admin/items', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                category_id: currentCatId,
                name_ru, name_en, description_ru, description_en, price, image
            })
        });

        // –û—á–∏—Å—Ç–∫–∞
        document.getElementById('item-name-ru').value = '';
        document.getElementById('item-price').value = '';
        document.getElementById('item-image').value = '';

        loadItems(currentCatId);
    }

    async function deleteItem(id) {
        if(confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
            await fetch(`/api/admin/items/${id}`, {method: 'DELETE'});
            loadItems(currentCatId);
        }
    }
</script>
</body>
</html>