<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админка меню</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="admin-container">
    <h1>Админка кофейни (пароль: 12345)</h1>
    <input type="password" id="admin-pass" placeholder="Введите пароль" class="admin-input">
    <button onclick="checkPassword()" class="admin-btn">Войти</button>

    <div id="admin-panel" class="hidden">
        <h2>Управление категориями</h2>
        <button onclick="addCategory()" class="admin-btn">+ Добавить категорию</button>
        <div id="categories-list"></div>

        <h2>Управление позициями</h2>
        <select id="cat-select" class="admin-input" onchange="loadItems()"></select>
        <button onclick="addItem()" class="admin-btn">+ Добавить позицию</button>
        <div id="items-list"></div>
    </div>
</div>

<script>
    let currentCatId = null;

    function checkPassword() {
        const pass = document.getElementById('admin-pass').value;
        if (pass === '12345') {
            document.getElementById('admin-panel').classList.remove('hidden');
            loadAdmin();
        } else {
            alert('Неправильный пароль!');
        }
    }

    async function loadAdmin() {
        try {
            const res = await fetch('/api/categories');
            const cats = await res.json();
            const catList = document.getElementById('categories-list');
            const select = document.getElementById('cat-select');
            catList.innerHTML = '';
            select.innerHTML = '<option value="">Выберите категорию</option>';

            cats.forEach(cat => {
                select.innerHTML += `<option value="${cat.id}">${cat.name_ru}</option>`;
                catList.innerHTML += `
            <div class="admin-item">
              <img src="${cat.image}" width="50" height="50" alt="${cat.name_ru}">
              <span>${cat.name_ru} / ${cat.name_en}</span>
              <button onclick="deleteCategory(${cat.id})" class="admin-delete">Удалить</button>
            </div>
          `;
            });
        } catch (err) {
            alert('Ошибка загрузки: ' + err);
        }
    }

    async function addCategory() {
        const name_ru = prompt('Название на русском:');
        if (!name_ru) return;
        const name_en = prompt('Название на английском:', name_ru);
        const image = prompt('Ссылка на фото (Unsplash или другая):', 'https://images.unsplash.com/photo-...');
        if (!image) return;

        try {
            await fetch('/api/admin/categories', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name_ru, name_en, image })
            });
            loadAdmin();
            alert('Категория добавлена!');
        } catch (err) {
            alert('Ошибка: ' + err);
        }
    }

    async function deleteCategory(id) {
        if (!confirm('Удалить категорию и все позиции в ней?')) return;
        try {
            await fetch(`/api/admin/categories/${id}`, { method: 'DELETE' });
            loadAdmin();
            alert('Удалено!');
        } catch (err) {
            alert('Ошибка: ' + err);
        }
    }

    async function loadItems() {
        const catId = document.getElementById('cat-select').value;
        if (!catId) return;
        currentCatId = catId;

        try {
            const res = await fetch(`/api/items/${catId}`);
            const items = await res.json();
            const list = document.getElementById('items-list');
            list.innerHTML = '';

            items.forEach(item => {
                list.innerHTML += `
            <div class="admin-item">
              <img src="${item.image}" width="50" height="50" alt="${item.name_ru}">
              <span>${item.name_ru} — ${item.price} ₽</span>
              <button onclick="deleteItem(${item.id})" class="admin-delete">Удалить</button>
            </div>
          `;
            });
        } catch (err) {
            alert('Ошибка загрузки позиций: ' + err);
        }
    }

    async function addItem() {
        if (!currentCatId) return alert('Сначала выберите категорию!');
        const name_ru = prompt('Название на русском:');
        if (!name_ru) return;
        const name_en = prompt('Название на английском:', name_ru);
        const desc_ru = prompt('Описание/состав на русском:');
        const price = parseFloat(prompt('Цена (₽):', '200'));
        const image = prompt('Ссылка на фото:', 'https://images.unsplash.com/photo-...');
        if (!image || isNaN(price)) return;

        try {
            await fetch('/api/admin/items', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    category_id: currentCatId,
                    name_ru,
                    name_en,
                    description_ru: desc_ru,
                    description_en: desc_ru,
                    price,
                    image
                })
            });
            loadItems();
            alert('Позиция добавлена!');
        } catch (err) {
            alert('Ошибка: ' + err);
        }
    }

    async function deleteItem(id) {
        if (!confirm('Удалить позицию?')) return;
        try {
            await fetch(`/api/admin/items/${id}`, { method: 'DELETE' });
            loadItems();
            alert('Удалено!');
        } catch (err) {
            alert('Ошибка: ' + err);
        }
    }
</script>
</body>
</html>